<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>{{.Title}}</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style id="theme-css">
{{.ThemeCSS}}
</style>
</head>
<body>
<script>
// Theme management
(function() {
  const savedTemplate = localStorage.getItem('template') || '{{.CurrentTemplate}}' || 'nordic';
  const savedScheme = localStorage.getItem('scheme') || '{{.CurrentScheme}}' || 'default';

  document.documentElement.setAttribute('data-template', savedTemplate);
  document.documentElement.setAttribute('data-scheme', savedScheme);

  // Hidden scheme menu for preferences modal to read from
  window.addEventListener('DOMContentLoaded', function() {
    const hiddenMenus = document.createElement('div');
    hiddenMenus.style.display = 'none';
    hiddenMenus.innerHTML = '<div id="schemeMenu">{{.SchemeMenuHTML}}</div>';
    document.body.appendChild(hiddenMenus);
  });
})();
</script>
  <div class="header">
    <div class="brand">
      <div class="dot"></div>
      <div>
        <div class="h-title">{{.Title}}</div>
        <div class="h-sub" id="subtitle">Loading…</div>
      </div>
    </div>

    <div class="search">
      <div class="searchbox">
        <input id="q" placeholder="Search…" autocomplete="off" />
        <div class="drop">
          <div class="pill" id="engineBtn">Google ▾</div>
          <div class="menu" id="engineMenu"></div>
        </div>
      </div>
      <div class="pill" id="goBtn">Go</div>
    </div>
  </div>

  <div class="main">
    <div class="grid" id="moduleGrid">
      <div class="card span-4" data-module="status" draggable="true">
        <h3><i class="fas fa-server"></i> Status<div class="header-icons"><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="badge"><span class="pulse"></span><span id="statusText">Online</span></div>
        <div class="kv"><div class="k">Host</div><div class="v mono" id="host">—</div></div>
        <div class="kv"><div class="k">Uptime</div><div class="v mono" id="uptime">—</div></div>
        <div class="kv"><div class="k">Server time</div><div class="v mono" id="time">—</div></div>
      </div>

      <div class="card span-4" data-module="network" draggable="true">
        <h3><i class="fas fa-network-wired"></i> Network<div class="header-icons"><div class="timer-circle" id="ipTimer" title="Double-click to refresh"></div><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="kv"><div class="k">LAN IPs</div><div class="v mono" id="lanIps">—</div></div>
        <div class="kv"><div class="k">Public IP</div><div class="v mono" id="pubIp">—</div></div>
        <div class="small" id="pubIpErr"></div>
      </div>

      <div class="card span-4" data-module="weather" draggable="true">
        <h3><i class="fas fa-cloud-sun"></i> Weather<div class="header-icons"><div class="timer-circle" id="weatherTimer" title="Double-click to refresh"></div><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="kv"><div class="k">Athens, Greece</div><div class="v" id="weather">—</div></div>
        <div id="weatherForecast"></div>
        <div class="small" id="weatherErr"></div>
      </div>

      <div class="card span-4" data-module="cpu" draggable="true">
        <h3><i class="fas fa-microchip"></i> CPU<div class="header-icons"><div class="timer-circle" id="cpuTimer" title="Double-click to refresh"></div><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="kv"><div class="k">Usage</div><div class="v" id="cpuUsage">—</div></div>
        <div class="small" id="cpuErr"></div>
        <div class="cpu-graph" id="cpuGraph"></div>
      </div>

      <div class="card span-4" data-module="ram" draggable="true">
        <h3><i class="fas fa-memory"></i> RAM<div class="header-icons"><div class="timer-circle" id="ramTimer" title="Double-click to refresh"></div><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="kv"><div class="k">Used</div><div class="v mono" id="ramUsed">—</div></div>
        <div class="kv"><div class="k">Total</div><div class="v mono" id="ramTotal">—</div></div>
        <div class="kv"><div class="k">Available</div><div class="v mono" id="ramAvailable">—</div></div>
        <div class="kv"><div class="k">Usage</div><div class="v" id="ramPercent">—</div></div>
        <div class="small" id="ramErr"></div>
      </div>

      <div class="card span-4" data-module="disk" draggable="true">
        <h3><i class="fas fa-hdd"></i> Disk<div class="header-icons"><div class="timer-circle" id="diskTimer" title="Double-click to refresh"></div><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="kv"><div class="k">Used</div><div class="v mono" id="diskUsed">—</div></div>
        <div class="kv"><div class="k">Total</div><div class="v mono" id="diskTotal">—</div></div>
        <div class="kv"><div class="k">Free</div><div class="v mono" id="diskFree">—</div></div>
        <div class="kv"><div class="k">Usage</div><div class="v" id="diskPercent">—</div></div>
        <div class="small" id="diskErr"></div>
      </div>

      <div class="card span-6" data-module="links" draggable="true">
        <h3><i class="fas fa-link"></i> Quick Links<div class="header-icons"><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="kv"><div class="k">Router</div><div class="v"><a class="btn" href="http://192.168.1.1" target="_blank" rel="noreferrer"><i class="fas fa-network-wired"></i> Open</a></div></div>
        <div class="kv"><div class="k">Proxmox / NAS</div><div class="v"><span class="small">Edit these in HTML</span></div></div>
        <div class="kv"><div class="k">Docs</div><div class="v"><span class="small">Add internal wiki links</span></div></div>
      </div>

      <div class="card span-6" data-module="utilities" draggable="true">
        <h3><i class="fas fa-tools"></i> Utilities<div class="header-icons"><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="kv"><div class="k">Ping</div><div class="v"><span class="small">Add /api/ping later</span></div></div>
        <div class="kv"><div class="k">Wake-on-LAN</div><div class="v"><span class="small">Add /api/wol later</span></div></div>
        <div class="kv"><div class="k">Service checks</div><div class="v"><span class="small">Add /api/checks later</span></div></div>
      </div>

      <div class="card span-6" data-module="github-user" draggable="true">
        <h3><i class="fab fa-github"></i> GitHub - Earentir<div class="header-icons"><a href="https://github.com/Earentir" target="_blank" rel="noreferrer"><i class="fas fa-external-link-alt"></i></a><div class="timer-circle" id="githubTimer" title="Double-click to refresh"></div><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="small" style="margin-bottom:8px; color:var(--muted);">Total: <span id="userRepoCount">—</span> repositories</div>
        <div id="githubUserRepos">
          <div class="small">Loading repositories...</div>
        </div>
        <div class="small" id="githubUserErr"></div>
      </div>

      <div class="card span-6" data-module="github-org" draggable="true">
        <h3><i class="fab fa-github"></i> GitHub - network-plane<div class="header-icons"><a href="https://github.com/network-plane" target="_blank" rel="noreferrer"><i class="fas fa-external-link-alt"></i></a><i class="fas fa-grip-vertical drag-handle" title="Drag to reorder"></i></div></h3>
        <div class="small" style="margin-bottom:8px; color:var(--muted);">Total: <span id="orgRepoCount">—</span> repositories</div>
        <div id="githubOrgRepos">
          <div class="small">Loading repositories...</div>
        </div>
        <div class="small" id="githubOrgErr"></div>
      </div>
    </div>
  </div>

  <div class="footer">
    <div class="left">
      <div class="small">Shortcuts:</div>
      <div class="badge"><span class="mono">/</span><span class="small">focus search</span></div>
      <div class="badge"><span class="mono">Enter</span><span class="small">search</span></div>
      <div class="badge"><span class="mono">E</span><span class="small">engine</span></div>
    </div>
    <div class="right">
      <a class="btn" href="/api/summary" target="_blank" rel="noreferrer"><i class="fas fa-code"></i> API</a>
      <a class="btn" href="/healthz" target="_blank" rel="noreferrer"><i class="fas fa-heartbeat"></i> Health</a>
      <div class="btn" id="refreshBtn"><i class="fas fa-sync-alt"></i> Refresh</div>
      <div class="btn" id="prefsBtn"><i class="fas fa-cog"></i> Preferences</div>
    </div>
  </div>

  <!-- Preferences Modal -->
  <div class="modal-overlay" id="prefsModal">
    <div class="modal">
      <div class="modal-header">
        <h2><i class="fas fa-cog"></i> Preferences</h2>
        <button class="modal-close" id="prefsClose"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-tabs">
        <button class="modal-tab active" data-tab="general"><i class="fas fa-sliders-h"></i> General</button>
        <button class="modal-tab" data-tab="modules"><i class="fas fa-th-large"></i> Modules</button>
        <button class="modal-tab" data-tab="about"><i class="fas fa-info-circle"></i> About</button>
      </div>
      <div class="modal-content">
        <div class="tab-content active" id="tab-general">
          <div class="pref-section">
            <h3>Appearance</h3>
            <div class="pref-row">
              <label>Theme</label>
              <select id="pref-template">
                {{range .TemplatesList}}<option value="{{.}}">{{.}}</option>{{end}}
              </select>
            </div>
            <div class="pref-row">
              <label>Color Scheme</label>
              <select id="pref-scheme"></select>
            </div>
          </div>
          <div class="pref-section">
            <h3>Data</h3>
            <div class="pref-row">
              <label>Clear cached data</label>
              <button class="btn-small" id="clearCacheBtn"><i class="fas fa-trash"></i> Clear Cache</button>
            </div>
            <div class="pref-row">
              <label>Reset module order</label>
              <button class="btn-small" id="resetOrderBtn"><i class="fas fa-undo"></i> Reset Order</button>
            </div>
          </div>
        </div>
        <div class="tab-content" id="tab-modules">
          <div class="pref-section">
            <h3>Module Settings</h3>
            <div class="module-list" id="moduleList"></div>
          </div>
        </div>
        <div class="tab-content" id="tab-about">
          <div class="pref-section about-section">
            <div class="about-logo"><i class="fas fa-home fa-3x"></i></div>
            <h3>Homepage Dashboard</h3>
            <p class="about-version">Version 1.0.0</p>
            <p class="about-desc">A personal dashboard for monitoring your system, weather, GitHub activity, and more.</p>
            <div class="about-links">
              <a href="https://github.com/Earentir/homepage" target="_blank" rel="noreferrer"><i class="fab fa-github"></i> Source Code</a>
            </div>
            <p class="about-copyright">© {{.Year}} Earentir</p>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
const engines = [
  {name:"Google", url:"https://www.google.com/search?q=%s"},
  {name:"Perplexity", url:"https://www.perplexity.ai/search?q=%s"},
  {name:"DuckDuckGo", url:"https://duckduckgo.com/?q=%s"},
  {name:"Brave", url:"https://search.brave.com/search?q=%s"},
  {name:"Bing", url:"https://www.bing.com/search?q=%s"},
  {name:"Wikipedia", url:"https://en.wikipedia.org/wiki/Special:Search?search=%s"},
  {name:"GitHub", url:"https://github.com/search?q=%s"},
  {name:"Stack Overflow", url:"https://stackoverflow.com/search?q=%s"},
  {name:"YouTube", url:"https://www.youtube.com/results?search_query=%s"},
  {name:"Reddit", url:"https://www.reddit.com/search/?q=%s"},
];

let engine = engines[0];

const q = document.getElementById('q');
const engineBtn = document.getElementById('engineBtn');
const engineMenu = document.getElementById('engineMenu');

function renderEngines(){
  engineMenu.innerHTML = "";
  engines.forEach((e) => {
    const b = document.createElement('button');
    b.textContent = e.name;
    b.onclick = () => {
      engine = e;
      engineBtn.textContent = e.name + " ▾";
      engineMenu.style.display = "none";
      q.focus();
    };
    engineMenu.appendChild(b);
  });
}
renderEngines();

engineBtn.onclick = () => {
  engineMenu.style.display = (engineMenu.style.display === "block") ? "none" : "block";
};

document.addEventListener('click', (ev) => {
  if (!engineBtn.contains(ev.target) && !engineMenu.contains(ev.target)) {
    engineMenu.style.display = "none";
  }
});

function goSearch(){
  const term = (q.value || "").trim();
  if(!term) return;
  const u = engine.url.replace("%s", encodeURIComponent(term));
  window.open(u, "_blank", "noreferrer");
}

document.getElementById('goBtn').onclick = goSearch;
q.addEventListener('keydown', (e) => { if(e.key === "Enter") goSearch(); });

document.addEventListener('keydown', (e) => {
  if (e.key === "/") { e.preventDefault(); q.focus(); }
  if (e.key.toLowerCase() === "e" && document.activeElement !== q) {
    engineMenu.style.display = "block";
  }
});

function fmtUptime(sec){
  sec = Math.max(0, sec|0);
  const d = Math.floor(sec/86400); sec%=86400;
  const h = Math.floor(sec/3600); sec%=3600;
  const m = Math.floor(sec/60); sec%=60;
  const parts = [];
  if(d) parts.push(d+"d");
  if(h) parts.push(h+"h");
  if(m) parts.push(m+"m");
  parts.push(sec+"s");
  return parts.join(" ");
}

// Timer management
const timers = {
  cpu: {interval: 5000, lastUpdate: 0, timer: null}, // 5 seconds
  ram: {interval: 5000, lastUpdate: 0, timer: null}, // 5 seconds
  disk: {interval: 15000, lastUpdate: 0, timer: null}, // 15 seconds
  github: {interval: 900000, lastUpdate: 0, timer: null}, // 15 minutes
  weather: {interval: 1800000, lastUpdate: 0, timer: null}, // 30 minutes
  ip: {interval: 7200000, lastUpdate: 0, timer: null}, // 2 hours
  general: {interval: 30000, lastUpdate: 0, timer: null} // 30 seconds for other data
};

function updateTimer(moduleName) {
  const timer = timers[moduleName];
  if (!timer) return;
  const elapsed = Date.now() - timer.lastUpdate;
  const remaining = Math.max(0, timer.interval - elapsed);
  const timerEl = document.getElementById(moduleName + "Timer");
  if (timerEl) {
    const seconds = Math.ceil(remaining / 1000);
    const percent = (elapsed / timer.interval) * 100;
    const percentClamped = Math.min(100, Math.max(0, percent));

    if (remaining > 0) {
      timerEl.title = "Next refresh in " + seconds + "s (double-click to refresh now)";
      timerEl.classList.remove("paused");
      // Update CSS variable for progress percentage
      timerEl.style.setProperty("--progress-percent", percentClamped + "%");
    } else {
      timerEl.title = "Ready to refresh (double-click to refresh now)";
      timerEl.classList.add("paused");
      timerEl.style.setProperty("--progress-percent", "100%");
    }
  }
}

function startTimer(moduleName) {
  const timer = timers[moduleName];
  if (!timer) return;
  timer.lastUpdate = Date.now();
  updateTimer(moduleName);
  if (timer.timer) clearInterval(timer.timer);
  timer.timer = setInterval(() => updateTimer(moduleName), 1000);
}

function formatBytes(bytes) {
  if (bytes === 0) return "0 B";
  const k = 1024;
  const sizes = ["B", "KB", "MB", "GB", "TB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return (bytes / Math.pow(k, i)).toFixed(2) + " " + sizes[i];
}

// CPU history for bar graph
const minBarWidth = 4; // Minimum width of each bar in pixels
const barGap = 2; // Gap between bars in pixels

// Load CPU history from localStorage
let cpuHistory = [];
try {
  const saved = localStorage.getItem('cpuHistory');
  if (saved) {
    cpuHistory = JSON.parse(saved);
  }
} catch (e) {
  cpuHistory = [];
}

function saveCpuHistory() {
  try {
    localStorage.setItem('cpuHistory', JSON.stringify(cpuHistory));
  } catch (e) {
    // Ignore storage errors
  }
}

function renderCpuGraph() {
  const graph = document.getElementById("cpuGraph");
  if (!graph || cpuHistory.length === 0) return;

  // Create bars for existing history
  while (graph.children.length < cpuHistory.length) {
    const bar = document.createElement("div");
    bar.className = "bar";
    graph.appendChild(bar);
  }

  // Update bar heights
  for (let i = 0; i < cpuHistory.length; i++) {
    const height = Math.max(2, (cpuHistory[i] / 100) * 26);
    graph.children[i].style.height = height + "px";
  }
}

function updateCpuGraph(usage) {
  const graph = document.getElementById("cpuGraph");
  if (!graph) return;

  // Calculate how wide each bar would be if we add one more
  const containerWidth = graph.clientWidth - 6; // Subtract padding
  const newBarCount = cpuHistory.length + 1;
  const barWidthIfAdded = (containerWidth - (barGap * (newBarCount - 1))) / newBarCount;

  // If adding a new bar would make bars less than 4px, remove oldest first
  if (barWidthIfAdded < minBarWidth && cpuHistory.length > 0) {
    cpuHistory.shift();
  }

  // Add new value
  cpuHistory.push(usage);
  saveCpuHistory();

  // Create bars if needed
  while (graph.children.length < cpuHistory.length) {
    const bar = document.createElement("div");
    bar.className = "bar";
    graph.appendChild(bar);
  }

  // Remove extra bars if needed (from the front - oldest)
  while (graph.children.length > cpuHistory.length) {
    graph.removeChild(graph.firstChild);
  }

  // Update bar heights (max height is 100% = 26px inside the container)
  for (let i = 0; i < cpuHistory.length; i++) {
    const height = Math.max(2, (cpuHistory[i] / 100) * 26);
    graph.children[i].style.height = height + "px";
  }
}

async function refreshCPU(){
  try{
    const res = await fetch("/api/system", {cache:"no-store"});
    const j = await res.json();
    if (j.cpu) {
      if (j.cpu.error) {
        document.getElementById("cpuUsage").textContent = "—";
        document.getElementById("cpuErr").textContent = j.cpu.error;
      } else {
        const usage = j.cpu.usage || 0;
        document.getElementById("cpuUsage").textContent = usage.toFixed(1) + "%";
        document.getElementById("cpuErr").textContent = "";
        updateCpuGraph(usage);
      }
    }
    startTimer("cpu");
  } catch(err){
    console.error("Error refreshing CPU:", err);
  }
}

async function refreshRAM(){
  try{
    const res = await fetch("/api/system", {cache:"no-store"});
    const j = await res.json();
    if (j.ram) {
      if (j.ram.error) {
        document.getElementById("ramUsed").textContent = "—";
        document.getElementById("ramTotal").textContent = "—";
        document.getElementById("ramAvailable").textContent = "—";
        document.getElementById("ramPercent").textContent = "—";
        document.getElementById("ramErr").textContent = j.ram.error;
      } else {
        document.getElementById("ramUsed").textContent = formatBytes(j.ram.used || 0);
        document.getElementById("ramTotal").textContent = formatBytes(j.ram.total || 0);
        document.getElementById("ramAvailable").textContent = formatBytes(j.ram.available || 0);
        document.getElementById("ramPercent").textContent = (j.ram.percent || 0).toFixed(1) + "%";
        document.getElementById("ramErr").textContent = "";
      }
    }
    startTimer("ram");
  } catch(err){
    console.error("Error refreshing RAM:", err);
  }
}

async function refreshDisk(){
  try{
    const res = await fetch("/api/system", {cache:"no-store"});
    const j = await res.json();
    if (j.disk) {
      if (j.disk.error) {
        document.getElementById("diskUsed").textContent = "—";
        document.getElementById("diskTotal").textContent = "—";
        document.getElementById("diskFree").textContent = "—";
        document.getElementById("diskPercent").textContent = "—";
        document.getElementById("diskErr").textContent = j.disk.error;
      } else {
        document.getElementById("diskUsed").textContent = formatBytes(j.disk.used || 0);
        document.getElementById("diskTotal").textContent = formatBytes(j.disk.total || 0);
        document.getElementById("diskFree").textContent = formatBytes(j.disk.free || 0);
        document.getElementById("diskPercent").textContent = (j.disk.percent || 0).toFixed(1) + "%";
        document.getElementById("diskErr").textContent = "";
      }
    }
    startTimer("disk");
  } catch(err){
    console.error("Error refreshing Disk:", err);
  }
}

async function refreshWeather(){
  try{
    const res = await fetch("/api/weather", {cache:"no-store"});
    const j = await res.json();

    document.getElementById("weather").textContent = j.summary || "—";
    const forecastContainer = document.getElementById("weatherForecast");
    if (j.forecast && j.forecast.length > 0) {
      forecastContainer.innerHTML = "";
      j.forecast.forEach((day) => {
        const kv = document.createElement("div");
        kv.className = "kv";
        const k = document.createElement("div");
        k.className = "k";
        k.textContent = day.split(":")[0];
        const v = document.createElement("div");
        v.className = "v";
        v.textContent = day.split(":")[1] || day;
        kv.appendChild(k);
        kv.appendChild(v);
        forecastContainer.appendChild(kv);
      });
    } else {
      forecastContainer.innerHTML = "";
    }
    document.getElementById("weatherErr").textContent = j.error || "";

    startTimer("weather");
  } catch(err){
    console.error("Error refreshing weather:", err);
  }
}

const GITHUB_CACHE_KEY = 'githubData';
const GITHUB_CACHE_MAX_AGE = 15 * 60 * 1000; // 15 minutes in milliseconds

function getGitHubCache() {
  try {
    const cached = localStorage.getItem(GITHUB_CACHE_KEY);
    if (cached) {
      const parsed = JSON.parse(cached);
      if (parsed.timestamp && Date.now() - parsed.timestamp < GITHUB_CACHE_MAX_AGE) {
        return { data: parsed.data, timestamp: parsed.timestamp };
      }
    }
  } catch (e) {
    // Ignore cache errors
  }
  return null;
}

function saveGitHubCache(data) {
  try {
    localStorage.setItem(GITHUB_CACHE_KEY, JSON.stringify({
      timestamp: Date.now(),
      data: data
    }));
  } catch (e) {
    // Ignore storage errors
  }
}

function renderGitHubData(j) {
    // GitHub user repos
    const userContainer = document.getElementById("githubUserRepos");
    const userErr = document.getElementById("githubUserErr");
    if (j.userRepos) {
      if (j.userRepos.repos && j.userRepos.repos.length > 0) {
        document.getElementById("userRepoCount").textContent = j.userRepos.total || j.userRepos.repos.length;
        userContainer.innerHTML = "";
        j.userRepos.repos.forEach((repo) => {
          const item = document.createElement("div");
          item.className = "repo-item";
          const name = document.createElement("div");
          name.className = "repo-name";
          const link = document.createElement("a");
          link.href = repo.url;
          link.target = "_blank";
          link.rel = "noreferrer";
          link.innerHTML = '<i class="fab fa-github"></i> ' + repo.fullName;
          name.appendChild(link);
          item.appendChild(name);
          if (repo.description) {
            const desc = document.createElement("div");
            desc.className = "repo-desc";
            desc.textContent = repo.description;
            item.appendChild(desc);
          }
          const meta = document.createElement("div");
          meta.className = "repo-meta";
          if (repo.stars > 0) {
            const stars = document.createElement("span");
            stars.innerHTML = '<i class="fas fa-star"></i> ' + repo.stars;
            meta.appendChild(stars);
          }
          if (repo.language) {
            const lang = document.createElement("span");
            lang.innerHTML = '<i class="fas fa-code"></i> ' + repo.language;
            meta.appendChild(lang);
          }
          if (repo.updated) {
            const updated = document.createElement("span");
            updated.innerHTML = '<i class="fas fa-clock"></i> ' + repo.updated;
            meta.appendChild(updated);
          }
          item.appendChild(meta);
          userContainer.appendChild(item);
        });
        userErr.textContent = "";
      } else if (j.userRepos && j.userRepos.error) {
        userContainer.innerHTML = "";
        userErr.textContent = j.userRepos.error;
      } else {
        userContainer.innerHTML = '<div class="small">No repositories found.</div>';
        userErr.textContent = "";
      }
    }

    // GitHub org repos
    const orgContainer = document.getElementById("githubOrgRepos");
    const orgErr = document.getElementById("githubOrgErr");
    if (j.orgRepos) {
      if (j.orgRepos.repos && j.orgRepos.repos.length > 0) {
        document.getElementById("orgRepoCount").textContent = j.orgRepos.total || j.orgRepos.repos.length;
        orgContainer.innerHTML = "";
        j.orgRepos.repos.forEach((repo) => {
          const item = document.createElement("div");
          item.className = "repo-item";
          const name = document.createElement("div");
          name.className = "repo-name";
          const link = document.createElement("a");
          link.href = repo.url;
          link.target = "_blank";
          link.rel = "noreferrer";
          link.innerHTML = '<i class="fab fa-github"></i> ' + repo.fullName;
          name.appendChild(link);
          item.appendChild(name);
          if (repo.description) {
            const desc = document.createElement("div");
            desc.className = "repo-desc";
            desc.textContent = repo.description;
            item.appendChild(desc);
          }
          const meta = document.createElement("div");
          meta.className = "repo-meta";
          if (repo.stars > 0) {
            const stars = document.createElement("span");
            stars.innerHTML = '<i class="fas fa-star"></i> ' + repo.stars;
            meta.appendChild(stars);
          }
          if (repo.language) {
            const lang = document.createElement("span");
            lang.innerHTML = '<i class="fas fa-code"></i> ' + repo.language;
            meta.appendChild(lang);
          }
          if (repo.updated) {
            const updated = document.createElement("span");
            updated.innerHTML = '<i class="fas fa-clock"></i> ' + repo.updated;
            meta.appendChild(updated);
          }
          item.appendChild(meta);
          orgContainer.appendChild(item);
        });
        orgErr.textContent = "";
      } else if (j.orgRepos && j.orgRepos.error) {
        orgContainer.innerHTML = "";
        orgErr.textContent = j.orgRepos.error;
      } else {
        orgContainer.innerHTML = '<div class="small">No repositories found.</div>';
        orgErr.textContent = "";
      }
    }
}

async function refreshGitHub(forceRefresh = false){
  try{
    // Check localStorage cache first (unless forcing refresh)
    if (!forceRefresh) {
      const cached = getGitHubCache();
      if (cached) {
        renderGitHubData(cached.data);
        // Set timer based on when the cache was created
        timers.github.lastUpdate = cached.timestamp;
        if (timers.github.timer) clearInterval(timers.github.timer);
        timers.github.timer = setInterval(() => updateTimer("github"), 1000);
        updateTimer("github");
        return;
      }
    }

    const res = await fetch("/api/github", {cache:"no-store"});
    const j = await res.json();

    // Save to localStorage cache
    saveGitHubCache(j);

    renderGitHubData(j);
    startTimer("github");
  } catch(err){
    console.error("Error refreshing GitHub:", err);
  }
}

async function refreshIP(){
  try{
    const res = await fetch("/api/ip", {cache:"no-store"});
    const j = await res.json();

    // Display LAN IPs with PTR records
    const lanIpsEl = document.getElementById("lanIps");
    if (j.network && j.network.hostIps && j.network.hostIps.length > 0) {
      const ipStrings = j.network.hostIps.map(ipInfo => {
        if (ipInfo.ptr) {
          return ipInfo.ip + " (" + ipInfo.ptr + ")";
        }
        return ipInfo.ip;
      });
      lanIpsEl.textContent = ipStrings.join(", ");
    } else {
      lanIpsEl.textContent = "—";
    }

    if (j.public && j.public.ip) {
      let pubIpText = j.public.ip;
      if (j.public.ptr) {
        pubIpText += " (" + j.public.ptr + ")";
      }
      document.getElementById("pubIp").textContent = pubIpText;
      document.getElementById("pubIpErr").textContent = "";
    } else {
      document.getElementById("pubIp").textContent = "—";
      document.getElementById("pubIpErr").textContent = (j.public && j.public.error) || "";
    }

    startTimer("ip");
  } catch(err){
    console.error("Error refreshing IP:", err);
  }
}

async function refresh(){
  try{
    const res = await fetch("/api/summary", {cache:"no-store"});
    const j = await res.json();

    document.getElementById("subtitle").textContent =
      j.server.os + "/" + j.server.arch + " • " + j.server.goVersion;

    document.getElementById("host").textContent = j.server.hostname;
    document.getElementById("uptime").textContent = fmtUptime(j.server.uptimeSec);
    document.getElementById("time").textContent = j.server.time;

  } catch(err){
    document.getElementById("statusText").textContent = "Degraded";
  }
}

document.getElementById("refreshBtn").onclick = refresh;

// Setup double-click handlers for timers
const refreshHandlers = {
  cpu: refreshCPU,
  ram: refreshRAM,
  disk: refreshDisk,
  github: refreshGitHub,
  weather: refreshWeather,
  ip: refreshIP
};

["cpu", "ram", "disk", "github", "weather", "ip"].forEach(module => {
  const timerEl = document.getElementById(module + "Timer");
  if (timerEl) {
    let lastClick = 0;
    timerEl.addEventListener("dblclick", (e) => {
      e.preventDefault();
      e.stopPropagation();
      const handler = refreshHandlers[module];
      if (handler) handler();
    });
    // Also handle click for better compatibility
    timerEl.addEventListener("click", (e) => {
      const now = Date.now();
      if (now - lastClick < 300) {
        e.preventDefault();
        e.stopPropagation();
        const handler = refreshHandlers[module];
        if (handler) handler();
      }
      lastClick = now;
    });
  }
});

// Initial refresh
refresh();
renderCpuGraph(); // Render saved CPU history
refreshCPU();
refreshRAM();
refreshDisk();
refreshGitHub();
refreshWeather();
refreshIP();

// Module configuration with defaults
const moduleConfig = {
  status: { name: 'Status', icon: 'fa-server', desc: 'Server status and uptime', hasTimer: false, enabled: true },
  network: { name: 'Network', icon: 'fa-network-wired', desc: 'LAN and public IP addresses', hasTimer: true, timerKey: 'ip', defaultInterval: 7200, enabled: true },
  weather: { name: 'Weather', icon: 'fa-cloud-sun', desc: 'Current weather and forecast', hasTimer: true, timerKey: 'weather', defaultInterval: 1800, enabled: true },
  cpu: { name: 'CPU', icon: 'fa-microchip', desc: 'CPU usage monitoring', hasTimer: true, timerKey: 'cpu', defaultInterval: 5, enabled: true },
  ram: { name: 'RAM', icon: 'fa-memory', desc: 'Memory usage monitoring', hasTimer: true, timerKey: 'ram', defaultInterval: 5, enabled: true },
  disk: { name: 'Disk', icon: 'fa-hdd', desc: 'Disk space monitoring', hasTimer: true, timerKey: 'disk', defaultInterval: 15, enabled: true },
  links: { name: 'Quick Links', icon: 'fa-link', desc: 'Custom shortcut links', hasTimer: false, enabled: true },
  utilities: { name: 'Utilities', icon: 'fa-tools', desc: 'System utilities', hasTimer: false, enabled: true },
  'github-user': { name: 'GitHub User', icon: 'fab fa-github', desc: 'Personal GitHub repositories', hasTimer: true, timerKey: 'github', defaultInterval: 900, enabled: true },
  'github-org': { name: 'GitHub Org', icon: 'fab fa-github', desc: 'Organization repositories', hasTimer: false, enabled: true }
};

// Load saved module preferences
function loadModulePrefs() {
  try {
    const saved = localStorage.getItem('modulePrefs');
    if (saved) {
      const prefs = JSON.parse(saved);
      Object.keys(prefs).forEach(key => {
        if (moduleConfig[key]) {
          if (typeof prefs[key].enabled !== 'undefined') {
            moduleConfig[key].enabled = prefs[key].enabled;
          }
          if (typeof prefs[key].interval !== 'undefined' && moduleConfig[key].hasTimer) {
            const timerKey = moduleConfig[key].timerKey;
            if (timers[timerKey]) {
              timers[timerKey].interval = prefs[key].interval * 1000;
            }
          }
        }
      });
    }
  } catch (e) {
    console.error('Error loading module prefs:', e);
  }
}

function saveModulePrefs() {
  try {
    const prefs = {};
    Object.keys(moduleConfig).forEach(key => {
      prefs[key] = { enabled: moduleConfig[key].enabled };
      if (moduleConfig[key].hasTimer) {
        const timerKey = moduleConfig[key].timerKey;
        if (timers[timerKey]) {
          prefs[key].interval = timers[timerKey].interval / 1000;
        }
      }
    });
    localStorage.setItem('modulePrefs', JSON.stringify(prefs));
  } catch (e) {
    console.error('Error saving module prefs:', e);
  }
}

function applyModuleVisibility() {
  Object.keys(moduleConfig).forEach(key => {
    const card = document.querySelector(`.card[data-module="${key}"]`);
    if (card) {
      card.style.display = moduleConfig[key].enabled ? '' : 'none';
    }
  });
}

// Load prefs on startup
loadModulePrefs();
applyModuleVisibility();

// Preferences Modal
(function() {
  const modal = document.getElementById('prefsModal');
  const openBtn = document.getElementById('prefsBtn');
  const closeBtn = document.getElementById('prefsClose');
  const tabs = document.querySelectorAll('.modal-tab');
  const tabContents = document.querySelectorAll('.tab-content');

  // Open modal
  openBtn.addEventListener('click', () => {
    modal.classList.add('active');
    renderModuleList();
    updateSchemeSelect();
  });

  // Close modal
  closeBtn.addEventListener('click', () => {
    modal.classList.remove('active');
  });

  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.remove('active');
    }
  });

  // Tab switching
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
    });
  });

  // Template/scheme selects
  const templateSelect = document.getElementById('pref-template');
  const schemeSelect = document.getElementById('pref-scheme');

  // Set current template value
  const currentTemplate = localStorage.getItem('template') || '{{.CurrentTemplate}}' || 'nordic';
  templateSelect.value = currentTemplate;

  templateSelect.addEventListener('change', () => {
    const newTemplate = templateSelect.value;
    localStorage.setItem('template', newTemplate);
    localStorage.setItem('scheme', 'default'); // Reset scheme when changing template
    document.cookie = 'template=' + newTemplate + '; path=/; max-age=31536000';
    document.cookie = 'scheme=default; path=/; max-age=31536000';
    location.reload();
  });

  function updateSchemeSelect() {
    const currentScheme = localStorage.getItem('scheme') || '{{.CurrentScheme}}' || 'default';
    // Get schemes from the existing scheme menu (uses buttons with data-scheme)
    const schemeMenu = document.getElementById('schemeMenu');
    schemeSelect.innerHTML = '';
    if (schemeMenu) {
      const schemeButtons = schemeMenu.querySelectorAll('button[data-scheme]');
      schemeButtons.forEach(btn => {
        const scheme = btn.getAttribute('data-scheme');
        const name = btn.textContent.trim();
        const option = document.createElement('option');
        option.value = scheme;
        option.textContent = name;
        if (scheme === currentScheme) option.selected = true;
        schemeSelect.appendChild(option);
      });
    }
  }

  schemeSelect.addEventListener('change', () => {
    const template = localStorage.getItem('template') || '{{.CurrentTemplate}}' || 'nordic';
    const newScheme = schemeSelect.value;
    localStorage.setItem('scheme', newScheme);
    document.cookie = 'scheme=' + newScheme + '; path=/; max-age=31536000';
    location.reload();
  });

  // Initialize scheme select on modal open
  updateSchemeSelect();

  // Clear cache button
  document.getElementById('clearCacheBtn').addEventListener('click', () => {
    localStorage.removeItem('cpuHistory');
    localStorage.removeItem('githubData');
    alert('Cache cleared!');
  });

  // Reset order button
  document.getElementById('resetOrderBtn').addEventListener('click', () => {
    localStorage.removeItem('moduleOrder');
    location.reload();
  });

  // Render module list
  function renderModuleList() {
    const list = document.getElementById('moduleList');
    list.innerHTML = '';

    Object.keys(moduleConfig).forEach(key => {
      const config = moduleConfig[key];
      const timerKey = config.timerKey;
      const currentInterval = timerKey && timers[timerKey] ? timers[timerKey].interval / 1000 : 0;

      const item = document.createElement('div');
      item.className = 'module-item' + (config.enabled ? '' : ' disabled');
      item.innerHTML = `
        <div class="module-icon"><i class="fas ${config.icon}"></i></div>
        <div class="module-info">
          <div class="module-name">${config.name}</div>
          <div class="module-desc">${config.desc}</div>
        </div>
        <div class="module-controls">
          ${config.hasTimer ? `
            <div class="refresh-control">
              <input type="number" min="1" value="${currentInterval}" data-module="${key}" data-timer="${timerKey}" data-default="${config.defaultInterval}">
              <span>sec</span>
              <button class="reset-btn" title="Reset to default (${config.defaultInterval}s)" data-module="${key}" data-timer="${timerKey}" data-default="${config.defaultInterval}"><i class="fas fa-undo"></i></button>
            </div>
          ` : ''}
          <input type="checkbox" ${config.enabled ? 'checked' : ''} data-module="${key}" title="Enable/disable module">
        </div>
      `;
      list.appendChild(item);

      // Enable/disable handler
      const checkbox = item.querySelector('input[type="checkbox"]');
      checkbox.addEventListener('change', () => {
        moduleConfig[key].enabled = checkbox.checked;
        item.classList.toggle('disabled', !checkbox.checked);
        saveModulePrefs();
        applyModuleVisibility();
      });

      // Interval change handler
      const intervalInput = item.querySelector('input[type="number"]');
      if (intervalInput) {
        intervalInput.addEventListener('change', () => {
          const newInterval = Math.max(1, parseInt(intervalInput.value) || config.defaultInterval);
          intervalInput.value = newInterval;
          if (timers[timerKey]) {
            timers[timerKey].interval = newInterval * 1000;
          }
          saveModulePrefs();
        });
      }

      // Reset button handler
      const resetBtn = item.querySelector('.reset-btn');
      if (resetBtn) {
        resetBtn.addEventListener('click', () => {
          const defaultVal = parseInt(resetBtn.dataset.default);
          if (intervalInput) {
            intervalInput.value = defaultVal;
            if (timers[timerKey]) {
              timers[timerKey].interval = defaultVal * 1000;
            }
            saveModulePrefs();
          }
        });
      }
    });
  }
})();

// Set up intervals - each module refreshes independently
setInterval(refresh, 30000); // General refresh every 30s (server info only)
setInterval(refreshCPU, timers.cpu.interval);
setInterval(refreshRAM, timers.ram.interval);
setInterval(refreshDisk, timers.disk.interval);
setInterval(refreshGitHub, timers.github.interval);
setInterval(refreshWeather, timers.weather.interval);
setInterval(refreshIP, timers.ip.interval);

// Drag and drop module ordering
(function() {
  const grid = document.getElementById('moduleGrid');
  if (!grid) return;

  let draggedElement = null;

  // Load saved order from localStorage
  function loadModuleOrder() {
    const savedOrder = localStorage.getItem('moduleOrder');
    if (!savedOrder) return;

    try {
      const order = JSON.parse(savedOrder);
      const cards = Array.from(grid.querySelectorAll('.card[data-module]'));

      // Create a map of modules by their data-module attribute
      const moduleMap = new Map();
      cards.forEach(card => {
        const moduleId = card.getAttribute('data-module');
        if (moduleId) {
          moduleMap.set(moduleId, card);
        }
      });

      // Reorder based on saved order
      order.forEach(moduleId => {
        const card = moduleMap.get(moduleId);
        if (card) {
          grid.appendChild(card);
        }
      });
    } catch (e) {
      console.error('Failed to load module order:', e);
    }
  }

  // Save current order to localStorage
  function saveModuleOrder() {
    const cards = Array.from(grid.querySelectorAll('.card[data-module]'));
    const order = cards.map(card => card.getAttribute('data-module')).filter(Boolean);
    localStorage.setItem('moduleOrder', JSON.stringify(order));
  }

  // Initialize drag and drop
  function initDragAndDrop() {
    const cards = grid.querySelectorAll('.card[data-module]');

    cards.forEach(card => {
      card.addEventListener('dragstart', function(e) {
        // Don't start drag if clicking on timer circle, links, or buttons
        const target = e.target;
        if (target.classList.contains('timer-circle') ||
            target.closest('.timer-circle') ||
            target.tagName === 'A' ||
            target.closest('a') ||
            target.tagName === 'BUTTON' ||
            target.closest('button')) {
          e.preventDefault();
          return false;
        }

        draggedElement = this;
        this.style.opacity = '0.5';
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
      });

      card.addEventListener('dragend', function(e) {
        this.style.opacity = '1';
        // Remove drag-over styling from all cards
        cards.forEach(c => {
          c.classList.remove('drag-over');
        });
        draggedElement = null;
      });

      card.addEventListener('dragover', function(e) {
        if (e.preventDefault) {
          e.preventDefault();
        }
        e.dataTransfer.dropEffect = 'move';

        if (draggedElement && this !== draggedElement) {
          this.classList.add('drag-over');
        }
        return false;
      });

      card.addEventListener('dragleave', function(e) {
        this.classList.remove('drag-over');
      });

      card.addEventListener('drop', function(e) {
        if (e.stopPropagation) {
          e.stopPropagation();
        }

        if (draggedElement && this !== draggedElement) {
          // Get the position of the current element
          const allCards = Array.from(grid.querySelectorAll('.card[data-module]'));
          const currentIndex = allCards.indexOf(this);
          const draggedIndex = allCards.indexOf(draggedElement);

          if (draggedIndex < currentIndex) {
            // Insert after current element
            grid.insertBefore(draggedElement, this.nextSibling);
          } else {
            // Insert before current element
            grid.insertBefore(draggedElement, this);
          }

          saveModuleOrder();
        }

        this.classList.remove('drag-over');
        return false;
      });
    });

    // Prevent drag when clicking on timer circles
    const timerCircles = grid.querySelectorAll('.timer-circle');
    timerCircles.forEach(timer => {
      timer.addEventListener('mousedown', function(e) {
        e.stopPropagation();
      });
      timer.addEventListener('dragstart', function(e) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      });
    });
  }

  // Load saved order on page load
  window.addEventListener('DOMContentLoaded', function() {
    loadModuleOrder();
    // Delay init to ensure all other handlers are set up first
    setTimeout(initDragAndDrop, 100);
  });
})();
</script>
<style>
.card[data-module] {
  user-select: none;
}
.card h3 .header-icons {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 8px;
}
.card[data-module] .drag-handle {
  opacity: 0.3;
  cursor: grab;
  font-size: 12px;
  transition: opacity 0.2s ease;
  pointer-events: auto;
}
.card[data-module]:hover .drag-handle {
  opacity: 0.6;
}
.card[data-module] .drag-handle:active {
  cursor: grabbing;
  opacity: 0.8;
}
.card.drag-over {
  border-color: var(--accent) !important;
  box-shadow: 0 0 0 2px var(--accent) !important;
  transform: scale(1.02);
}
.card[data-module] .timer-circle {
  pointer-events: auto;
  flex-shrink: 0;
}
.card h3 .header-icons a {
  opacity: 0.7;
  transition: opacity 0.2s;
  display: flex;
  align-items: center;
}
.card h3 .header-icons a:hover {
  opacity: 1;
}
.card[data-module="cpu"] {
  display: flex;
  flex-direction: column;
}
.cpu-graph {
  display: flex;
  align-items: flex-end;
  gap: 2px;
  height: 32px;
  width: 100%;
  margin-top: auto;
  background: rgba(0,0,0,0.1);
  border-radius: 4px;
  overflow: hidden;
  padding: 3px;
}
.cpu-graph .bar {
  flex: 1;
  min-width: 0;
  background: var(--accent);
  border-radius: 2px;
  transition: height 0.3s ease;
  opacity: 0.8;
}
.cpu-graph .bar:last-child {
  opacity: 1;
}

/* Preferences Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(4px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  padding: 20px;
}
.modal-overlay.active {
  display: flex;
}
.modal {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  width: 100%;
  max-width: 600px;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
}
.modal-header h2 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--txt);
  display: flex;
  align-items: center;
  gap: 10px;
}
.modal-close {
  background: none;
  border: none;
  color: var(--muted);
  cursor: pointer;
  font-size: 16px;
  padding: 5px;
  transition: color 0.2s;
}
.modal-close:hover {
  color: var(--txt);
}
.modal-tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
}
.modal-tab {
  background: none;
  border: none;
  color: var(--muted);
  padding: 12px 16px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  border-bottom: 2px solid transparent;
  margin-bottom: -1px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}
.modal-tab:hover {
  color: var(--txt);
}
.modal-tab.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
}
.modal-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}
.pref-section {
  margin-bottom: 24px;
}
.pref-section:last-child {
  margin-bottom: 0;
}
.pref-section h3 {
  margin: 0 0 12px 0;
  font-size: 12px;
  font-weight: 600;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.pref-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
}
.pref-row:last-child {
  border-bottom: none;
}
.pref-row label {
  color: var(--txt);
  font-size: 13px;
  font-weight: 500;
}
.pref-row select,
.pref-row input[type="number"] {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--txt);
  padding: 6px 10px;
  font-size: 13px;
  min-width: 140px;
}
.pref-row select:focus,
.pref-row input[type="number"]:focus {
  outline: none;
  border-color: var(--accent);
}
.btn-small {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--txt);
  padding: 6px 12px;
  font-size: 12px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s;
}
.btn-small:hover {
  border-color: var(--accent);
  color: var(--accent);
}

/* Module List */
.module-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.module-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  transition: border-color 0.2s;
}
.module-item:hover {
  border-color: var(--accent);
}
.module-item .module-icon {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(var(--accent-rgb, 136,192,208), 0.1);
  border-radius: 6px;
  color: var(--accent);
  font-size: 14px;
}
.module-item .module-info {
  flex: 1;
  min-width: 0;
}
.module-item .module-name {
  font-size: 13px;
  font-weight: 600;
  color: var(--txt);
}
.module-item .module-desc {
  font-size: 11px;
  color: var(--muted);
  margin-top: 2px;
}
.module-item .module-controls {
  display: flex;
  align-items: center;
  gap: 8px;
}
.module-item input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: var(--accent);
  cursor: pointer;
}
.module-item .refresh-control {
  display: flex;
  align-items: center;
  gap: 4px;
}
.module-item .refresh-control input[type="number"] {
  width: 60px;
  padding: 4px 6px;
  font-size: 12px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--txt);
  text-align: center;
}
.module-item .refresh-control input[type="number"]:focus {
  outline: none;
  border-color: var(--accent);
}
.module-item .refresh-control span {
  font-size: 11px;
  color: var(--muted);
}
.module-item .reset-btn {
  background: none;
  border: none;
  color: var(--muted);
  cursor: pointer;
  padding: 4px;
  font-size: 12px;
  transition: color 0.2s;
}
.module-item .reset-btn:hover {
  color: var(--accent);
}
.module-item.disabled {
  opacity: 0.5;
}
.module-item.disabled .module-controls .refresh-control {
  pointer-events: none;
}

/* About Tab */
.about-section {
  text-align: center;
  padding: 20px;
}
.about-logo {
  color: var(--accent);
  margin-bottom: 16px;
}
.about-section h3 {
  font-size: 18px;
  color: var(--txt);
  margin-bottom: 4px;
  text-transform: none;
  letter-spacing: 0;
}
.about-version {
  color: var(--muted);
  font-size: 12px;
  margin-bottom: 16px;
}
.about-desc {
  color: var(--txt);
  font-size: 13px;
  line-height: 1.6;
  margin-bottom: 20px;
}
.about-links {
  margin-bottom: 20px;
}
.about-links a {
  color: var(--accent);
  text-decoration: none;
  font-size: 13px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
.about-links a:hover {
  text-decoration: underline;
}
.about-copyright {
  color: var(--muted);
  font-size: 11px;
}
</style>
</body>
</html>
